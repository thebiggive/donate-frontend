<main>
  <biggive-heading
    space-above=0
    space-below=3
    colour="black"
    html-element="h1"
    size="1"
    align="left"
    text="Reset your Password"
  ></biggive-heading>

  <mat-spinner
    *ngIf="tokenValid === undefined"
    aria-label="Loading"
    color="primary"
    diameter="15"
  ></mat-spinner>

  <!-- Note: check explicitly for `undefined` here, not for `!saveSuccessful`, because
  `saveSuccessful` has can be undefined, false, or true, all with a unique meaning. -->
  <div *ngIf="saveSuccessful === undefined && !savingNewPassword && tokenValid">
    <form [formGroup]="passwordForm">
      <p class="b-rt-0">Please enter your new password (min {{ minPasswordLength }} characters)</p>
      <mat-form-field color="primary">
          <mat-label>Password</mat-label>
          <input matInput type="password" formControlName="password">
      </mat-form-field>
      <mat-form-field color="primary">
          <mat-label>Re-enter your password</mat-label>
          <input matInput type="password" formControlName="confirmPassword" (focus)="onPasswordConfirmationFocus()">
      </mat-form-field>
      <div *ngIf="confirmPasswordField?.errors?.notSame" class="error">Passwords must be the same!</div>
    </form>

    <button
      id="reset-modal-submit"
      mat-raised-button
      [disabled]="!passwordForm.valid || savingNewPassword"
      (click)="saveNewPassword()"
      color="primary"
    >Save new password</button>
  </div>

  <!-- If processing, show spinner -->
  <div *ngIf="saveSuccessful === undefined && savingNewPassword">
    <mat-spinner [diameter]="40" aria-label="Loading your details"></mat-spinner>
  </div>

  <p *ngIf="saveSuccessful">
    You have reset your password. Please click <a href="/">here</a> for the homepage, or <a href="/transfer-funds">here</a> to transfer donation funds to your account.
  </p>

  <!-- Note: check explicitly for `saveSuccessful === false` here, not for `!saveSuccessful`,
  because `saveSuccessful` has can be undefined, false, or true, all with a unique meaning. -->
  <p *ngIf="saveSuccessful === false && ! errorMessage" class="error">
    Sorry, there was an error saving your new password. Your link may have expired. Please <a href="https://community.biggive.org/s/contact-us" target="_blank">contact us</a> if this message persists.
  </p>

  <p *ngIf="saveSuccessful === false && errorMessage" class="error">
    {{errorMessage}}
  </p>

  <div *ngIf="tokenValid === false"  class="error">
    Sorry, your link may have expired. Please <a href="https://community.biggive.org/s/contact-us" target="_blank">contact us</a> if this message persists.
  </div>

</main>
